<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>ä»£ç†è¯·æ±‚</title>
</head>

<body>
  <div id="stock-info"></div>

  <script>
    function formatLabelString(str, params) {
      try {
        str = str.replace(/\$\{(.*?)\}/gi, function (_, $1) {
          const formatMatch = /(.*?)\s*\|\s*padRight\s*(\|\s*(\d+))?/gi.exec($1);

          if (formatMatch) {
            return formatTreeText(
              params[formatMatch[1]],
              formatMatch[3] ? parseInt(formatMatch[3]) : undefined
            );
          } else {
            return String(params[$1]);
          }
        });
      } catch (err) {
        // @ts-ignore
        window.showErrorMessage(`fail: Label format Error, ${str};\n${err.message}`);
        return 'æ¨¡æ¿æ ¼å¼é”™è¯¯ï¼';
      }
      return str;
    }
    const statusBarItemLabelFormat = "ã€Œ${name}ã€${price}  ${icon}ï¼ˆ${percent}ï¼‰";
    fetch('http://localhost:3000/stock?code=sz000065,sh000001,hf_OIL')
      .then(res => res.json())
      .then(resp => {
        let stockArr = [];
        for (let i = 0; i < resp.length; i++) {
          const item = resp[i];
          const stockBarItem = {}
          


          const { code, percent, open, yestclose, high, low, updown, amount } = item;
          const deLow = percent.indexOf('-') === -1;
          /* stockBarItem.text = `ã€Œ${this.stockService.showLabel ? item.info.name : item.id}ã€${price}  ${
            deLow ? 'ğŸ“ˆ' : 'ğŸ“‰'
          }ï¼ˆ${percent}%ï¼‰`; */
          stockBarItem.text = formatLabelString(statusBarItemLabelFormat, {
            ...item,
            percent: `${percent}%`,
            icon: deLow ? 'ğŸ“ˆ' : 'ğŸ“‰',
          });

          stockBarItem.tooltip = `ã€Œä»Šæ—¥è¡Œæƒ…ã€ ${
            item?.name ?? 'ä»Šæ—¥è¡Œæƒ…'
          }ï¼ˆ${code}ï¼‰\næ¶¨è·Œï¼š${updown}   ç™¾åˆ†ï¼š${percent}%\næœ€é«˜ï¼š${high}   æœ€ä½ï¼š${low}\nä»Šå¼€ï¼š${open}   æ˜¨æ”¶ï¼š${yestclose}\næˆäº¤é¢ï¼š${amount}\næ›´æ–°æ—¶é—´ï¼š${
            item?.time
          }`;
          stockBarItem.color = deLow ? '#FF0000' : '#00FF00';
          stockArr.push(stockBarItem);
        }
        console.log(stockArr);
        // document.getElementById('stock-info').innerHTML = JSON.stringify(stockArr);
      });
  </script>
</body>

</html>